{% comment %}
  HypeHeat Customer Addresses
  View, add, edit, and delete saved addresses.
{% endcomment %}

<div class="customer-page">
  <a href="{{ routes.account_url }}" class="customer-page__back">&larr; Back to Account</a>

  <h1 class="customer-page__title">Your Addresses</h1>

  <button type="button" id="AddressNewToggle" class="btn btn--primary customer-page__new-btn">Add New Address</button>

  {%- comment -%} New address form (hidden by default) {%- endcomment -%}
  <div id="AddressNewForm" class="customer-address__form-wrap" style="display: none;">
    <h2 class="customer-page__subtitle">New Address</h2>
    {% form 'customer_address', customer.new_address %}
      {% include 'customer-address-fields' %}
      <div class="customer-page__actions">
        <button type="submit" class="btn btn--primary">Save</button>
        <button type="button" class="customer-page__link" onclick="document.getElementById('AddressNewForm').style.display='none'">Cancel</button>
      </div>
    {% endform %}
  </div>

  {%- comment -%} Existing addresses {%- endcomment -%}
  {% if customer.addresses.size > 0 %}
    <div class="customer-address__list">
      {% for address in customer.addresses %}
        <div class="customer-address__card">
          {% if address == customer.default_address %}
            <span class="customer-address__default">Default</span>
          {% endif %}
          <div class="customer-address__content">
            {{ address | format_address }}
          </div>
          <div class="customer-address__actions">
            <button type="button" class="customer-page__link" onclick="document.getElementById('EditAddress_{{ address.id }}').style.display = document.getElementById('EditAddress_{{ address.id }}').style.display === 'none' ? 'block' : 'none'">Edit</button>
            <button type="button" class="customer-page__link customer-page__link--danger" data-confirm="Are you sure?" onclick="if(confirm('Are you sure you want to delete this address?')) Shopify.postLink('/account/addresses/{{ address.id }}', {parameters: {_method: 'delete'}})">Delete</button>
          </div>

          <div id="EditAddress_{{ address.id }}" class="customer-address__form-wrap" style="display: none;">
            {% form 'customer_address', address %}
              {% include 'customer-address-fields', form_address: address %}
              <div class="customer-page__actions">
                <button type="submit" class="btn btn--primary">Update</button>
                <button type="button" class="customer-page__link" onclick="document.getElementById('EditAddress_{{ address.id }}').style.display='none'">Cancel</button>
              </div>
            {% endform %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="customer-page__note" style="margin-top: 20px;">No saved addresses yet.</p>
  {% endif %}
</div>

<script>
  document.getElementById('AddressNewToggle').addEventListener('click', function () {
    var form = document.getElementById('AddressNewForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  });
</script>

{% schema %}
{
  "name": "Customer Addresses",
  "settings": []
}
{% endschema %}
