{% comment %}
  HypeHeat AJAX Cart Drawer
  Slides from right side. Includes shipping progress bar.
  Dynamically updated via JS — the Liquid here provides initial server-rendered state.
{% endcomment %}

<div class="cart-drawer-overlay" id="CartDrawerOverlay"></div>

<div class="cart-drawer" id="CartDrawer" aria-label="Shopping cart">
  <div class="cart-drawer__header">
    <h2 class="cart-drawer__title">Your Cart</h2>
    <button class="cart-drawer__close" id="CartDrawerClose" aria-label="Close cart">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="cart-drawer__shipping" id="CartShipping">
    <div class="cart-drawer__shipping-text" id="CartShippingText">
      {% assign threshold = settings.free_shipping_threshold | default: 150 | times: 100 %}
      {% if cart.total_price >= threshold %}
        You've unlocked <strong>FREE SHIPPING</strong>
      {% else %}
        {% assign remaining = threshold | minus: cart.total_price %}
        Spend <strong>{{ remaining | money }}</strong> more for <strong>FREE SHIPPING</strong>
      {% endif %}
    </div>
    <div class="cart-drawer__shipping-bar">
      {% assign progress = cart.total_price | times: 100 | divided_by: threshold %}
      {% if progress > 100 %}{% assign progress = 100 %}{% endif %}
      <div class="cart-drawer__shipping-fill" id="CartShippingFill" style="width: {{ progress }}%"></div>
    </div>
  </div>

  <div class="cart-drawer__timer" id="CartTimer" style="display: none;">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="16" height="16" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
    <span>Your cart is reserved for <strong id="CartTimerDisplay">15:00</strong></span>
  </div>

  <div class="cart-drawer__items" id="CartDrawerItems">
    {% if cart.item_count > 0 %}
      {% for item in cart.items %}
        <div class="cart-drawer__item" data-line="{{ forloop.index }}">
          {% if item.image %}
            {{ item.image | image_url: width: 140, height: 180, crop: 'center' | image_tag: class: 'cart-drawer__item-image' }}
          {% endif %}
          <div class="cart-drawer__item-info">
            <div class="cart-drawer__item-title">{{ item.product.title }}</div>
            {% if item.variant.title != 'Default Title' %}
              <div class="cart-drawer__item-variant">{{ item.variant.title }}</div>
            {% endif %}
            <div class="cart-drawer__item-price">{{ item.final_line_price | money }}</div>
            <div class="cart-drawer__item-qty">
              <button type="button" data-qty-change="-1" data-line="{{ forloop.index }}" aria-label="Decrease quantity">−</button>
              <span>{{ item.quantity }}</span>
              <button type="button" data-qty-change="1" data-line="{{ forloop.index }}" aria-label="Increase quantity">+</button>
            </div>
            <button type="button" class="cart-drawer__item-remove" data-line="{{ forloop.index }}" data-qty-change="remove">Remove</button>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="cart-drawer__empty">Your cart is empty</div>
    {% endif %}
  </div>

  <div class="cart-drawer__footer" id="CartDrawerFooter">
    <div class="cart-drawer__subtotal">
      <span class="cart-drawer__subtotal-label">Subtotal</span>
      <span class="cart-drawer__subtotal-price" id="CartSubtotal">{{ cart.total_price | money }}</span>
    </div>
    <a href="{{ routes.cart_url }}/checkout" class="btn btn--primary cart-drawer__checkout">
      Checkout
    </a>
  </div>
</div>

{% schema %}
{
  "name": "Cart Drawer",
  "settings": []
}
{% endschema %}
